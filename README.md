# 电气工程

**电气工程**是以[电子学](https://zh.wikipedia.org/wiki/%E9%9B%BB%E5%AD%90%E5%AD%B8 "电子学")、[电磁学](https://zh.wikipedia.org/wiki/%E9%9B%BB%E7%A3%81%E5%AD%B8 "电磁学")等[物理学](https://zh.wikipedia.org/wiki/%E7%89%A9%E7%90%86%E5%AD%A6 "物理学")分支为基础，涵盖[电子学](https://zh.wikipedia.org/wiki/%E9%9B%BB%E5%AD%90%E5%AD%B8 "电子学")、[电子计算机](https://zh.wikipedia.org/wiki/%E9%9B%BB%E5%AD%90%E8%A8%88%E7%AE%97%E6%A9%9F "电子计算机")、[电力工程](https://zh.wikipedia.org/wiki/%E9%9B%BB%E5%8A%9B%E5%B7%A5%E7%A8%8B "电力工程")、[电信](https://zh.wikipedia.org/wiki/%E7%94%B5%E4%BF%A1 "电信")、[控制工程](https://zh.wikipedia.org/wiki/%E6%8E%A7%E5%88%B6%E5%B7%A5%E7%A8%8B "控制工程")、[讯号处理](https://zh.wikipedia.org/wiki/%E8%A8%8A%E8%99%9F%E8%99%95%E7%90%86 "讯号处理")、[机械电子学](https://zh.wikipedia.org/wiki/%E6%9C%BA%E6%A2%B0%E7%94%B5%E5%AD%90%E5%AD%A6 "机械电子学")等子领域的一门[工程学](https://zh.wikipedia.org/wiki/%E5%B7%A5%E7%A8%8B%E5%AD%B8 "工程学")。十九世纪后半期以来，随著[电报](https://zh.wikipedia.org/wiki/%E9%9B%BB%E5%A0%B1 "电报")、[电话](https://zh.wikipedia.org/wiki/%E9%9B%BB%E8%A9%B1 "电话")、[电能](https://zh.wikipedia.org/wiki/%E9%9B%BB%E8%83%BD "电能")在供应与使用方面的商业化，该学科逐渐发展为相对独立的专业领域。

电机工程广义上涵盖该领域的分支，但在有些地方，“电气工程”（英语：Electrical Engineering）一词的意义有时不包括“[电子工程学](https://zh.wikipedia.org/wiki/%E7%94%B5%E5%AD%90%E5%B7%A5%E7%A8%8B "电子工程")”（英语：Electronic Engineering）。这个情况下，“电气工程”是指涉及到大能量的[电力系统](https://zh.wikipedia.org/wiki/%E9%9B%BB%E5%8A%9B%E7%B3%BB%E7%B5%B1 "电力系统")（如[电能传输](https://zh.wikipedia.org/wiki/%E8%BC%B8%E9%9B%BB%E7%B3%BB%E7%B5%B1 "输电系统")、重型[电机机械](https://zh.wikipedia.org/wiki/%E9%9B%BB%E6%A9%9F%E6%A9%9F%E6%A2%B0 "电机机械")及[电动机](https://zh.wikipedia.org/wiki/%E7%94%B5%E5%8A%A8%E6%9C%BA "电动机")），而“电子工程”则是指处理小信号的电子系统（如[计算机](https://zh.wikipedia.org/wiki/%E7%94%B5%E5%AD%90%E8%AE%A1%E7%AE%97%E6%9C%BA "电子计算机")和[积体电路](https://zh.wikipedia.org/wiki/%E7%A9%8D%E9%AB%94%E9%9B%BB%E8%B7%AF "积体电路")）。

另一种区分法为，电力工程师著重于电能的传输，而电子工程师则著重于利用电子讯号进行资讯的传输。这些子领域的范围有时也会重叠：例如，[电力电子学](https://zh.wikipedia.org/wiki/%E7%94%B5%E5%8A%9B%E7%94%B5%E5%AD%90%E5%AD%A6 "电力电子学")使用电力电子元件对电能进行变换和控制；又如，[智慧电网](https://zh.wikipedia.org/wiki/%E6%99%BA%E6%85%A7%E9%9B%BB%E7%B6%B2 "智慧电网")侦测电能供应者的电能供应状况与一般家庭使用者的电能使用状况，并据之调整家电用品的耗电量，以此达到节约能源、降低损耗、增强[输电网路](https://zh.wikipedia.org/wiki/%E8%BC%B8%E9%9B%BB%E7%B6%B2%E8%B7%AF "输电网路")可靠性的目的。因此，电机工程亦函盖电子工程部分领域的专业知识。

## BMS电池系统

电池管理系统，BMS（Battery Management System），是电动汽车动力电池系统的重要组成。它一方面检测收集并初步计算电池实时状态参数，并根据检测值与允许值的比较关系控制供电回路的通断；另一方面，将采集的关键数据上报给整车控制器，并接收控制器的指令，与车辆上的其他系统协调工作。

```
电动汽车用锂离子电池容量大、串并联节数多，系统复杂，加之安全性、耐久性、动力性等性能要求高、实现难度大，因此成为影响电动汽车推广普及的瓶颈。锂离子电池安全工作区域受到温度、电压窗口限制，超过该窗口的范围，电池性能就会加速衰减，甚至发生安全问题。目前，大部分车用锂离子电池，要求的可靠工作温度为，放电时-20~55°C，充电时0~45°C（对石墨负极），而对于负极LTO充电时最低温度为-30°C；工作电压一般为1.5~4.2 V左右（对于LiCoO2/C、LiNi0.8Co0.15Al0.05O2/C、LiCoxNiyMnzO2/C以及LiMn2O4/C等材料体系约2.5~4.2 V，对于LiMn2O4/Li4Ti5O12 材料体系约1.5~2.7 V，对于LiFePO4/C 材料体系约2.0~3.7 V）。

温度对锂电池性能尤其安全性具有决定性的影响，根据电极材料类型的不同，锂电池（C/LiMn2O4 ， C/LMO，C/LiCoxNiyMnzO2 ，C/NCM， C/LiFePO4 ，C/LiNi0.8Co0.15Al0.05O2， C/NCA）典型的工作温度如下：放电在-20-55℃，充电在0-45℃；负极材料为Li4Ti5O12 或者 LTO时，最低充电温度往往可以达到-30℃。

当温度过高时，会给电池的寿命造成不利影响。当温度高至一定程度，则可能造成安全问题。如图所示图1中，当温度为90~120 ℃时，SEI 膜将开始放热分解[1 ~3] ，而一些电解质体系会在较低温度下分解约69℃ [4]。当温度超过120℃，SEI 膜分解后无法保护负碳电极 ，使得 负极与有机电解质直接反应，产生可燃气体将[3] 。当温度为130 ℃，隔膜将开始熔化并关闭离子通道，使得电池的正负极暂时没有电流流动[5,6] 。当温度升高时，正极材料开始分解（LiCoO 2 开始分解约在150 ℃[7] ，LiNi0.8Co0.15Al0.05O2在约160 ℃[8,9]，LiNixCoyMnzO2 在约210℃[8]，LiMn2O4 在约265 ℃ [1] ，LiFePO4在约310℃ [7] ）并产生氧气。当温度高于200℃时，电解液会分解并产生可燃性气体[3] ，并且与由正极的分解产生的氧气剧烈反应[9] ，进而导致热失控。在0℃以下充电，会造成锂金属在负极表面形成电镀层，这会减少电池的循环寿命。[10]

过低的电压或者过放电，会导致电解液分解并产生可燃气体进而导致潜在安全风险。过高的电压或者过充电，可能导致正极材料失去活性，并产生大量的热；普通电解质在电压高于4.5 V时会分解[12]

为了解决这些问题，人们试图开发能够在非常恶劣的情况下进行工作的新电池系统，另一方面，目前商业化锂离子电池必须连接管理系统，使锂离子电池可以得到有效的控制和管理，每个单电池都在适当的条件下工作，充分保证电池的安全性、耐久性和动力性。
```

在BMS算法研究的初期SOC（state of charge）和SOS（state of safe）是最容易得到关注的算法，这两个算法的准确性能直接影响动力电池的可用性和安全性，避免车辆在行驶中抛锚，充电中过充，直接关系产品的使用和用户的安全。

### 电池管理系统定义
电池管理系统的主要任务是保证电池系统的设计性能，可以分解成如下三个方面：
1）安全性，保护电池单体或电池组免受损坏，防止出现安全事故；
2）耐久性，使电池工作在可靠的安全区域内，延长电池的使用寿命；
3）动力性，维持电池工作在满足车辆要求的状态下。锂离子电池的安全工作区域如图1所示。

![](readme.assets/Pasted%20image%2020230730204207.png)
```
BMS由各类传感器、执行器、控制器以及信号线等组成，为满足相关的标准或规范，BMS应该具有以下功能。

1）电池参数检测。包括总电压、总电流、单体电池电压检测（防止出现过充、过放甚至反极现象）、温度检测（最好每串电池、关键电缆接头等均有温度传感器）、烟雾探测（监测电解液泄漏等）、绝缘检测（监测漏电）、碰撞检测等。

2）电池状态估计。包括荷电状态（SOC）或放电深度（DOD）、健康状态（SOH）、功能状态（SOF）、能量状态（SOE）、故障及安全状态（SOS）等。

3）在线故障诊断。包括故障检测、故障类型判断、故障定位、故障信息输出等。故障检测是指通过采集到的传感器信号，采用诊断算法诊断故障类型，并进行早期预警。电池故障是指电池组、高压电回路、热管理等各个子系统的传感器故障、执行器故障（如接触器、风扇、泵、加热器等），以及网络故障、各种控制器软硬件故障等。电池组本身故障是指过压（过充）、欠压（过放）、过电流、超高温、内短路故障、接头松动、电解液泄漏、绝缘降低等。

4）电池安全控制与报警。包括热系统控制、高压电安全控制。BMS诊断到故障后，通过网络通知整车控制器，并要求整车控制器进行有效处理（超过一定阈值时BMS也可以切断主回路电源），以防止高温、低温、过充、过放、过流、漏电等对电池和人身的损害。

5）充电控制。BMS中具有一个充电管理模块，它能够根据电池的特性、温度高低以及充电机的功率等级，控制充电机给电池进行安全充电。

6）电池均衡。不一致性的存在使得电池组的容量小于组中最小单体的容量。电池均衡是根据单体电池信息，采用主动或被动、耗散或非耗散等均衡方式，尽可能使电池组容量接近于最小单体的容量。

7）热管理。根据电池组内温度分布信息及充放电需求，决定主动加热/散热的强度，使得电池尽可能工作在最适合的温度，充分发挥电池的性能。

8）网络通讯。BMS需要与整车控制器等网络节点通信；同时，BMS在车辆上拆卸不方便，需要在不拆壳的情况下进行在线标定、监控、自动代码生成和在线程序下载（程序更新而不拆卸产品）等，一般的车载网络均采用CAN总线技术。

9）信息存储。用于存储关键数据，如SOC、SOH、SOF、SOE、累积充放电Ah数、故障码和一致性等。车辆中的真实BMS可能只有上面提到的部分硬件和软件。每个电池单元至少应有一个电池电压传感器和一个温度传感器。对于具有几十个电池的电池系统，可能只有一个BMS控制器，或者甚至将BMS功能集成到车辆的主控制器中。对于具有数百个电池单元的电池系统，可能有一个主控制器和多个仅管理一个电池模块的从属控制器。对于每个具有数十个电池单元的电池模块，可能存在一些模块电路接触器和平衡模块，并且从控制器像测量电压和电流一样管理电池模块，控制接触器，均衡电池单元并与主控制器通信。根据所报告的数据，主控制器将执行电池状态估计，故障诊断，热管理等。

10）电磁兼容。由于电动车使用环境恶劣，要求BMS具有好的抗电磁干扰能力，同时要求BMS对外辐射小。
```
#### BMS关键问题

##### **电池电压测量（CVM）**
1）电动汽车的电池组有数百个电芯的串联连接，需要许多通道来测量电压。由于被测量的电池电压有累积电势，而每个电池的积累电势都不同，这使得它不可能采用单向补偿方法消除误差。
![](https://pic2.zhimg.com/80/v2-e1eb72605d62f63ee42f7031f29dda29_1440w.webp)
图3 OCV曲线和每毫伏电压的SOC的变化（在25℃测量，休息时间3小时）

2）电压测量需要高精度（特别是对于C / LiFePO 4 电池）。
SOC估算对电池电压精度提出了很高的要求。这里我们以C / LFP和LTO / NCM型电池为例。图3显示了电池C / LiFePO 4 和LTO / NCM 的开路电压（OCV）以及每mV电压对应的SOC变化。从图中我们可以看到LTO / NCM的OCV曲线的斜率相对陡峭，且大多数SOC范围内，每毫伏的电压变化对应的最大SOC率范围低于0.4％（除了SOC 60~70％）。因此，如果电池电压的测量精度为10mV，那么通过OCV估计方法获得的SOC误差低于4％。因此，对于LTO / NCM电池，电池电压的测量精度需要小于10 mV。但C / LiFePO 4OCV曲线的斜率相对平缓，并且在大多数范围内（除了SOC < 40％和65 ~80％），每毫伏电压的最大相应SOC变化率达到4％。因此，电池电压的采集精度要求很高，达到1 mV左右。目前，电池电压的大部分采集精度仅达到5 mV。在文献[47]和[48]中，分别总结了锂电池组和燃料电池组的电压测量方法。这些方法包括电阻分压器方法，光耦合隔离放大器方法，离散晶体管的方法[49] ，分布式测量方[50] ，光耦合中继方法[51] 等等。目前，电池的电压和温度采样已形成芯片产业化，表1比较了大多数BMS所用芯片的性能。
![](https://pic3.zhimg.com/80/v2-b5d64314bdbaeeaf6df81b0272d678e2_1440w.webp)
表1 统计电池管理和均衡芯片

##### 数据采样频率同步性
信号的采样频率与同步对数据实时分析和处理有影响。设计BMS时，需要对信号的采样频率和同步精度提出要求。但目前部分BMS设计过程中，对信号采样频率和同步没有明确要求。电池系统信号有多种，同时电池管理系统一般为分布式，如果电流的采样与单片电压采样分别在不同的电路板上；信号采集过程中，不同控制子板信号会存在同步问题，会对内阻的实时监测算法产生影响。同一单片电压采集子板，一般采用巡检方法，单体电压之间也会存在同步问题，影响不一致性分析。系统对不同信号的数据采样频率和同步要求不同，对惯性大的参量要求较低，如纯电动车电池正常放电的温升数量级为1℃/10 min，考虑到温度的安全监控，同时考虑BMS温度的精度（约为1℃），温度的采样间隔可定为30 s（对混合动力电池，温度采样率需要更高一些）。

电压与电流信号变化较快，采样频率和同步性要求很高。由交流阻抗分析可知，动力电池的欧姆内阻响应在ms级，SEI膜离子传输阻力电压响应为10 ms级，电荷转移（双电容效应）响应为1~10 s级，扩散过程响应为min级。目前，电动车加速时，驱动电机的电流从最小变化到最大的响应时间约为0.5 s，电流精度要求为1%左右，综合考虑变载工况的情况，电流采样频率应取10~200 Hz。单片信息采集子板电压通道数一般为6 的倍数，目前最多为24 个。一般纯电动乘用车电池由约100 节电池串联组成，单体电池信号采集需要多个采集子板。为了保证电压同步，每个采集子板中单体间的电压采样时间差越小越好，一个巡检周期最好在25 ms内。子板之间的时间同步可以通过发送一帧CAN参考帧来实现。数据更新频率应为10 Hz以上。

#### 电池状态估计
![](readme.assets/Pasted%20image%2020230730204806.png)
### 电池温度估计
温度对电池性能影响较大，目前一般只能测得电池表面温度，而电池内部温度需要使用热模型进行估计。常用的电池热模型包括零维模型（集总参数模型）、一维乃至三维模型。零维模型可以大致计算电池充放电过程中的温度变化，估计精度有限，但模型计算量小，因此可用于实时的温度估计。一维、二维及三维模型需要使用数值方法对传热微分方程进行求解，对电池进行网格划分，计算电池的温度场分布，同时还需考虑电池结构对传热的影响（结构包括内核、外壳、电解液层等）。一维模型中只考虑电池在一个方向的温度分布，在其他方向视为均匀。二维模型考虑电池在两个方向的温度分布，对圆柱形电池来说，轴向及径向的温度分布即可反映电池内部的温度场。二维模型一般用于薄片电池的温度分析。三维模型可以完全反映方形电池内部的温度场，仿真精度较高，因而研究较多。但三维模型的计算量大，无法应用于实时温度估计，只能用于在实验室中进行温度场仿真。为了让三维模型的计算结果实时应用，研究人员利用三维模型的温度场计算结果，将电池产热功率和内外温差的关系用传递函数表达，通过产热功率和电池表面温度估计电池内部的温度，具有在BMS中应用的潜力。
![](readme.assets/Pasted%20image%2020230730204908.png)
一般地，锂离子电池适宜的工作温度为15~35℃，而电动汽车的实际工作温度为-30～50℃，因此必须对电池进行热管理，低温时需要加热，高温时需要冷却。热管理包括设计与控制两方面，其中，热管理设计不属于本文内容。温度控制是通过测温元件测得电池组不同位置的温度，综合温度分布情况，热管理系统控制电路进行散热，热管理的执行部件一般有风扇、水/油泵、制冷机等。比如，可以根据温度范围进行分档控制。Volt插电式混合动力电池热管理分为3种模式：主动（制冷散热）、被动（风扇散热）和不冷却模式，当动力电池温度超过某预先设定的被动冷却目标温度后，被动散热模式启动；而当温度继续升高至主动冷却目标温度以上时，主动散热模式启动。

### SOC电量估计算法
电池管理系统，应用的关键技术之一，传统燃油车有油表，能跑多远，看一眼心里就有数了，换成电动汽车，**SOC就是电动汽车的”油表”**，所以SOC的准确、稳定与否非常重要。SOC的定义粗略的说就是，SOC=剩余容量/额定容量(满充容量)*100%，更浅显的比喻就是剩余容量就好比汽车里面剩余的油，额定容量就是汽车的油箱容量，SOC就是剩余的”油”和”油箱容量”的比值。这个”剩余的油”和”油箱容量”越精确，用户使用起来就会越放心。
![](readme.assets/Pasted%20image%2020230730192521.png)
- 放电测试法
	- 确定电池SOC的最可靠方法是在受控条件下进行放电测试，即指定的放电速率和环境温度。这个测试可以准确的计算电池的剩余电量SOC，但所消耗的时间相当长，并且在测试完毕以后电池里面的电量全部放掉，因此这个方法只在实验室中用来标定验证电池的标称容量，无法用于设计 BMS做车辆电池电量的在线估计。
	- 改进方法：**基于电池性能的SOC 估计法**
		- 基于电池性能的SOC估计方法包括交流阻抗法、直流内阻法和放电试验法。交流阻抗法是通过对交流阻抗谱与SOC 的关系进行SOC 估计。直流内阻法通过直流内阻与电池SOC 的关系进行估计。
		- 交流阻抗及直流内阻一般仅用于电池离线诊断，很难直接应用在车用SOC实时估计中，这是因为，采用交流阻抗的方法需要有信号发生器，会增加成本；电池阻抗谱或内阻与SOC 关系复杂，影响因素多（包括内阻一致性）；电池内阻很小，车用电池在毫欧级，很难准确获得；锂离子电池内阻在很宽范围内变化较小，很难识别。
- 模糊逻辑方法
	- 模糊逻辑法基本思路就是根据大量试验曲线、经验及可靠的模糊逻辑理论依据，用模糊逻辑模拟人的模糊思维，最终实现SOC预测，但该算法首先需要对电池本身有足够多的了解，计算量也较大。

#### 推荐计算电池电量方法
- 主流数学方法
	- 开路电压法（OCV）
		- 开路电压法其原理是利用电池在长时间静置的条件下，开路电压与SOC存在相对固定的函数关系，从而根据开路电压来估算SOC。以前常用的铅蓄电池电动自行车就是使用这种方法估算SOC
		- 电池须经过长期静置，但电动汽车启动频繁，开路电压短时间内很难稳定；
		- 电池存在电压平台，特别是磷酸铁[锂电池](https://news.bjx.com.cn/topics/lidianchi/)，在SOC30%-80%期间，端电压和SOC曲线近似为直线；
		- 电池处于不同温度或不同寿命时期，尽管开路电压一样，但实际上的SOC差别可能较大；
		- 改进方法：**基于电池模型的开路电压法**
		- ![](readme.assets/Pasted%20image%2020230730200937.png)
	- 电流积分法
		- 电流积分法估算SOC目前广泛应用于电动自行车、园林工具、储能等领域。虽然很多不同的BMS厂家都是用电流积分法估算SOC，但是由于各自算法设计、硬件电路、电流采样芯片选择的不同精度也各不相同。电流积分法也叫安时积分法(也叫电流积分法或库仑计数法)，其本质是在电池进行充电或放电时，通过累积充进或放出的电量来估算电池的SOC。与其它SOC估算方法相比，电流积分法相对可靠，并且可以动态地估算电池的SOC值，因此被广泛使用。
		- 电流采样造成误差: 采样精度采样间隔
		- 电池容量变化造成误差: 温度变化电池老化充放电倍率不同电池自放电
		- 初始SOC估算困难
		- ![](readme.assets/Pasted%20image%2020230730201150.png)
		该方法只是以电池的外部特征作为SOC估算依据，在一定程度上忽视了电池自放电率、老化程度和充放电倍率对电池SOC的影响，长期使用也会导致测量误差不断累积扩大，因此需要引入相关修正系数对累积误差进行纠正。

下面简单介绍下我们BMS保护板使用的SOC估算方法。我们算法的主要是针对电流积分法计算SOC的局限性进行改进：

●电池包第一次上电使用开路电压法估算SOC。第一次上电，根据电池包厂家给出的电压和剩余容量二维关系图大概估算出目前电池包的剩余容量即SOC。

![](http://img01.mybjx.net/news/UploadFile/201902/6368575345664331699450015.jpg "5.webp.jpg")

●第一次循环以后都使用电流积分法（安时法）计算SOC，此时电流采样的精度决定了安时法估算SOC的精度，因此前端采样芯片的选择很重要，我们的BMS选择是国外的前端芯片，保证电流采样尽可能的精确。

●针对电池老化的问题,我们在电池包每次完整的充放电循环后,对电池包满充容量进行实时修正,这样我们可以更准确的获取电池包的实际满充容量。这就好比你有个容量是200L油桶(电池包的设计容量),使用了一段时间磕磕碰碰，油桶形状改变了，我们不知道他的实际容量了,但是我们可以知道每次油桶空了到加满所需要的油的体积（一次完整充电容量如下图180L）,我们就可以用这个体积（一次完整的充放电的时间）对这个油桶的实际容量（电池包的实际容量）进行细微的修正，即从放空电（由于实际电池包应用场景的不同，修正的下限可能不一定是放空,更具不同的实际情况而设置）到充满电。见下图，如果满充容量修正不准，即使剩余容量是准确的，SOC也是不准确的，会使用户做出错误的判断。因此要使SOC更准确，剩余容量和满充容量都要尽量的准确。![](http://img01.mybjx.net/news/UploadFile/201902/6368575345665031739450015.jpg "6.webp.jpg")

●针对自放电的问题，我们在电池包不充放电时，用平均工作电流或者休眠功耗乘以时间来修正由于自放电引起的SOC误差。我们的SOC修正算法还加入了温度的修正，依据电池特性，在不同的温度下，电池能释放的电能不一样，我们在算法里面加入了温度系数的修正，这里就不详说了。目前我们通过大量的实际测试和应用SOC误差在4%以内。

- 卡尔曼滤波法
	- 卡尔曼滤波法的核心思想是**对动力系统的状态做出最小方差意义上的最优估计。**应用于动力电池SOC估计，动力电池被看成动力系统，SOC是系统的一个内部状态。卡尔曼滤波法估计动力电池SOC的研究在近年才开始。该方法适用于各种动力电池，与其他方法相比，尤其适合于电流波动比较剧烈的混合动力汽车动力电池SOC的估计。它不仅给出了SOC的估计值，还给出了SOC的估计误差，**缺点是**对动力汽车电池模型库准确性和计算能力要求高。
- 神经网络法
	- 神经网络模型法估计SOC 是利用神经网络的非线性映射特性，在建立模型时不用具体考虑电池的细节问题，方法具有普适性，适用于各种电池的SOC估计，但是需要大量样本数据对网络进行训练，且估算误差受训练数据和训练方法的影响很大，且神经网络法运算量大，需要强大的运算芯片（如DSP等）。

#### 融合算法

目前融合算法包括简单修正、加权、卡尔曼滤波或扩展卡尔曼滤（EKF）、滑模变结构等。简单修正的融合算法主要包括开路电压修正、满电修正的安时积分法等。

对于纯电动车电池，工况较为简单，车辆运行时除了少量制动回馈充电外主要处于放电态，站上充电时电池处于充电态，开路电压的滞回效应比较容易估计；电池容量大，安时积分的误差相对较小；充满电的机率大，因此，采用开路电压标定初值和满电修正的安时积分方法可以满足纯电动车电池SOC 的估计精度要求。

对于混合动力车电池，由于工况复杂，运行中为了维持电量不变，电流有充有放；停车时除了维护外，没有站上充电的机会；电池容量较小，安时积分的相对误差大。因此，简单的开路电压修正方法还不能满足混合动力车电池SOC 的估计精度要求，需要其他融合方法解决。

加权融合算法是将不同方法得到的SOC 按一定权值进行加权估计的方法。Mark Verbrugge等采用安时积分获得SOCc与采用具有滞回的一阶RC模型获得SOCv的加权方法估计SOC，计算公式为
![](https://pic4.zhimg.com/80/v2-20d1693dcfa10c9f0e35473ae48aae0f_1440w.webp)
公式中，w 为权值。该算法已经在GM混合动力系统中应用。

卡尔曼滤波是一种常用的融合算法。由于SOC不能直接测量，目前一般将两种估计SOC 的方法融合起来估计。SOC被当成电池系统的一个内部状态分析。又由于电池系统为非线性系统，因此采用扩展的卡尔曼滤波方法，通常采用安时积分与电池模型组成系统进行计算。Plett等研究了安时积分与组合模型、Rint模型（简单模型）、零状态滞回Rint模型、一状态滞回Rint模型、加强自修正模型的卡尔曼滤波融合算法。Wang等研究了安时积分与二阶RC模型的卡尔曼滤波融合算法。

夏超英等研究了安时积分与一阶RC模型的卡尔曼滤波算法，指出EKF作为一个状态观测器，其意义在于用安时积分法计算SOC的同时，估计出电容上的电压，从而得到电池端电压的估计值作为校正SOC 的依据，同时考虑噪声及误差的大小，确定每一步的滤波增益，得到开路电压法在计算SOC 时应占的权重，从而得到SOC 的最优估计。这样就把安时积分法和开路电压有机地结合起来，用开路电压克服了安时积分法有累积误差的缺点，实现了SOC 的闭环估计。同时，由于在计算过程中考虑了噪声的影响，所以算法对噪声有很强的抑制作用。这是当前应用最广的SOC估计方法。

Charkhgard等采用卡尔曼滤波融合了安时积分与神经网络模型，卡尔曼滤波用于SOC 计算的核心是建立合理的电池等效模型，建立一组状态方程，因此算法对电池模型依赖性较强，要获得准确的SOC，需要建立较为准确的电池模型，为了节省计算量，模型还不能太复杂。Ouyang等提出一种实时性好的基于电化学机理的等效电路模型的SOC 卡尔曼滤波算法，在保证计算速度基础上，提高了SOC 的估计效果，尤其是低SOC 区的估计精度。但是卡尔曼滤波法的缺点还有卡尔曼增益不好确定，如果选择不好状态将发散。Kim等提出采用滑模技术克服卡尔曼滤波的缺点，据称该方法对于模型参数不确定和干扰具有较强的鲁棒性。

**电池组SOC 估计**
电池组由多节电池串并联组成，由于电池单体间存在不一致性，成组后的电池组SOC 计算更为复杂。由多个电芯并联连接的电池模块可以被认为是具有高容量的单个电池，并且由于并联连接的自平衡特性，可以像单个电池一样估计SOC。

![](https://pic1.zhimg.com/80/v2-c79234e87105b1019dfdb3d5938f1214_1440w.webp)
图6.电池模块的无用容量和剩余容量（以2个电池的电池模块为例）

在串联连接条件下，粗略的估计电池模块的SOC也可以像单体电池一样，但考虑到电池的均匀性，情形会有些不同。假设电池模块中每个单体电池的容量和SOC是已知的。如果有一个非常高效且无损的能量均衡装置，则电池模块的SOC：
![](https://pic3.zhimg.com/80/v2-f06bdd52ee62516238c9904003ef939e_1440w.webp)
其中，SOCM 表示电池模块的SOC，SOCi 表示第i个电池单元的SOC，Ci 表示第i个电池单体的容量。如果平衡装置不是那么有效，真正的电池模块的SOC与该平衡装置的实际性能有关。如果只有耗散式的被动均衡功能或者没有均衡功能，则电芯中存在一部分无法利用的容量如图5所示，并且随着电池差异性的加剧，这种浪费的容量的比例会越来越大。因此，电池模块的容量表示为：
![](https://pic1.zhimg.com/80/v2-403d8f0c02e64d499c8de1c4366de57c_1440w.webp)
电池模块可用容量表示为：
![](https://pic3.zhimg.com/80/v2-5920d5792195dcec4a5833e60bcb904a_1440w.webp)
电池模组的荷电状态表示为：
![](https://pic4.zhimg.com/80/v2-8caac0d6bbb000d9bcdce50b1f5047ab_1440w.webp)
由此，在每一节电池单体SOC 都可估计的前提下，就可以得到电池组的SOC 值。要获取单体的SOC值，最直接的方法就是应用上述SOC 估计方法中的一种，分别估计每一个单体的SOC，但这种方法的计算量太大。为了减小计算量，部分文献在估计电池成组的SOC 方法上做了一些改进研究。Dai 等采用一个EKF 估计电池组平均SOC，用另一个EKF 估计每个单体SOC 与平均SOC 之差ΔSOC。估计ΔSOC 的EKF中需要估计的状态量只有一个，因此算法的计算量较小。另外，考虑到ΔSOC 的变化很慢，采用双时间尺度的方法可以进一步减小计算量。Zheng等提出了一种M+D模型，即一个相对复杂的电池单体平均模型M，和一个简单的单体差异模型D，利用最小二乘法计算单体与“平均单体”之间的差值ΔOCV，通过ΔSOC 与ΔOCV 的关系，可以计算每个单体的SOC 值。综合比较上述常用的SOC 估计方法，卡尔曼滤波等基于电池模型的SOC 估计方法精确可靠，是目前的主流方法。

### SOS安全状态估计
故障诊断是保证电池安全的必要技术之一。安全状态估计属于电池故障诊断的重要项目之一，BMS可以根据电池的安全状态给出电池的故障等级。目前导致电池严重事故的是电池的热失控，以热失控为核心的安全状态估计是最迫切的需求。导致热失控的主要诱因有过热、过充电、自引发内短路等。研究过热、内短路的热失控机理可以获得电池的热失控边界。Feng等研究了一款三元电池的热失控行为，获得了3个特征温度。Ouyang等研究了一款复合三元材料电池的过充电热失控行为，获得了4个过充电特征阶段。这些研究为电池的安全状态估计提供了基础。

故障诊断技术目前已发展成为一门新型交叉学科。故障诊断技术基于对象工作原理，综合计算机网络、数据库、控制理论、人工智能等技术，在许多领域中的应用已经较为成熟。锂离子电池的故障诊断技术尚属于发展阶段，研究主要依赖于参数估计、状态估计及基于经验等方法（与上述SOH研究类似）。Bohlen等通过电池内阻模型的在线辨识实现了电池在线诊断。Sun等铅酸电池的健康状态（SOH）上，假设正常状态的恒流充放电电压曲线是光滑的，通过观察其充放电曲线的变化辨识电池组可能存在的故障。电动汽车动力往往由成百上千个电池单体串并联构成，个体之间存在一定的差异，即不一致性。一般地，不一致性服从统计分布规律，这为电池组的故障诊断提供了一种理论依据。

Zheng等建立了一种考虑接触电阻的电池分频模型，以代表低频的电池平均模型研究电池组总体行为，以代表高频的差异模型研究电池组一致性问题，成功辨识了电池组内的接触电阻故障。Ouyang等同样采用分频模型，通过内短路电池造成一致性变差特性来诊断内短路的发生。

### SOH健康状态评估
健康状态是指电池当前的性能与正常设计指标的偏离程度。电池老化是电池正常的性能衰减，不能完全代表其健康状态。而目前多数SOH 的定义仅限于电池老化的范畴，没有真正涉及电池的健康状况（如健康、亚健康、轻微问题、严重问题等），因此目前的算法应该称为寿命状态。

耐久性是当前业界研究热点，表征电池寿命的主要参数是容量和内阻。一般地，能量型电池的性能衰减用容量衰减表征，功率型电池性能衰减用电阻变化表征。为了估计电池的衰减性能，首先要了解电池的衰减机理。

锂电池衰减机理。锂离子电池为“摇椅式”电池，正负极的活性材料可以看作容纳锂离子的两个水桶，锂离子相当于桶里的水。电池的性能衰减可以理解为“水”变少（即活性锂离子损失），或“桶”变小（正极或负极活性物质变少），如下图所示。导致活性锂离子损失的主要原因是：电极与电解液副反应形成钝化膜（如SEI膜）；由于充放电电池膨胀收缩疲劳导致电极龟裂，导致电极与电解液副反应形成新的SEI膜，消耗锂离子；不当充电导致的析锂与电解液反应消耗锂离子。导致活性材料损失的主要原因包括：材料中的锰、铁或镍等离子溶解；活性材料颗粒脱落；活性材料晶格塌陷。目前SOH 估计方法主要分为耐久性经验模型估计法和基于电池模型的参数辨识方法。
![](https://pic4.zhimg.com/80/v2-97ff89783d6bf2c38881f45c9401a78f_1440w.webp)
锂离子电池双水箱模型

#### 耐久性经验模型估计法

耐久性经验模型估计法是基于电池耐久性测试数据标定获得的模型，直接预测容量衰减和内阻的变化。电池的耐久性模型可以分为耐久性机理模型和耐久性外特性模型，两者的主要区别在于，前者侧重于对电池内部副反应机理的研究，并以SEI膜内阻、离子浓度等微观量为观测对象；而后者从试验规律出发，重点关注电池循环过程中表现出来的容量衰减与内阻增加。有文献根据正负极衰老机理，基于循环锂离子损失机理以及电池内部的材料腐蚀机理，建立了电池SEI膜内阻增加模型以及循环衰减后的端电压模型。由于详细的锂离子电池衰减机理十分复杂，目前还很难准确确定模型的参数，同时运算量也较大，一般不用于车用电池管理中。

基于电池外特性的模型，已经有较多文献涉及，最常见的性能衰减模型是基于Arrhenius规律的模型。Toshiba的手册中给出了钴酸锂电池贮存寿命模型
![](https://pic3.zhimg.com/80/v2-aa81f580413c0920bb29ced33e0ff806_1440w.webp)
式中，Closs为容量损失百分比，%；T 为温度，K；t 为时间，月。Bloom等进行了不同环境温度下电池衰减率的试验与分析，试验了以温度为加速应力的电池容量衰减模型，讨论了电池容量保持率与环境温度和循环时间的关系，提出
![](https://pic3.zhimg.com/80/v2-b5345283bb6bbae310b5bd8ff0f4478e_1440w.webp)
式中，Qloss 为阻抗增加率（area specific impedance ，ASI）或最大输出功率，W/s或W；A 为常数；Ea为反应活化能，J；R 是气体常量，J/(mol·K)；T 是绝对温度，K；t 是时间，h；z 是时间模态，简单情况下可取1/2。其中A、Ea/R、z 都可以通过试验数据用拟合的方法得到。
Wang等基于Bloom等的工作，提出了以Ah 循环总量为变量的双因素模型，将放电倍率乘入原有的时间项，得到以温度和放电倍率为加速应力的电池寿命模型，实现了双应力加速下20%以内的预测误差，即
![](https://pic2.zhimg.com/80/v2-f6e5cb8a2466a2d949c953c533315e2d_1440w.webp)
公式中，Qloss为容量损失百分比，%；Ah 为安时循环总量，Ah；其他参数的定义与前面公式相同。
Matsushima研究了大型锂离子电池的性能衰减，发现容量的衰减与时间呈1/2次方关系，即Qloss=Kf×t^(1/2)，并发现容量衰减在30%以内时的系数Kf与容量衰减大于30%时的系数Kf不相同。前者较大，说明前30%容量衰减的速度快。Kf服从阿伦尼乌斯定律。进一步地，基于Arrhenius模型的扩展模型，如黎火林、苏金然根据对钴酸锂电池循环寿命的试验，提出了如下的Arrhenius扩展模型：
![](https://pic1.zhimg.com/80/v2-0bdf21cf015f5f12d736e2f76c47f214_1440w.webp)
公式中，Cτ为容量衰减率，%；nc为充放电循环寿命，次；T 为绝对温度，K；I 为放电电流，A；a、b、c、l、m、f、α、β、λ、η均为常数，可以通过试验拟合确定。

Li等考虑了电池寿命的多个影响因素，如环境温度、放电倍率、放电截止电压、充电倍率和充电截止电压等，提出了基于耦合强度判断和多因素输入的寿命建模方法（模型中温度的影响也参考了Arrhenius建模方法、电物理量的影响参考逆幂规律），并基于模型的因素敏感性分析了各因素对电池寿命影响的权重，耐久性模型对电池寿命的预测误差为15%以内。

Han等在分析电池性能衰减基础上，认为以石墨为负极的锂离子电池的性能衰减主要是因为负极SEI膜增厚消耗活性锂离子，正常的SEI膜增厚消耗的锂离子与时间呈1/2次方关系，但一般电池存在疲劳龟裂消耗了更多的活性锂离子，因此性能衰减与时间的关系大于1/2 次方。基于Arrhenius模型建立了4款以石墨为负极的锂离子电池的性能衰减离散模型，并提出基于该离散模型的闭环参数修正方法，经过几次容量修正后，模型参数趋于稳定。

其他外特性建模方法还有神经网络模型，如Jungst等在研究以LiNi0.8Co0.15Al0.05O2为正极材料的电池贮存寿命时建立的神经网络模型。借鉴机械疲劳研究成果，Safari等采用机械疲劳研究中常用的Palmgren-Miner（PM）法则预测电池容量在简单和复杂工况下的衰减情况，并与损害时间累计法（capacity-lossaccumulation over time，LAT）进行比较，结果表明PM法好于LAT法。

#### 基于电池模型参数辨识法

参数辨识方法主要基于已有的电池模型，采用最优状态估计技术，如最小二乘法、卡尔曼滤波等算法，根据运行的数据，对电池模型参数如容量、内阻等进行辨识，从而获得电池的寿命状态。

Plett将内阻和容量作为系统状态参数，构建了内阻估计状态方程和容量估计状态方程。采用扩展的双卡尔曼滤波方法获得内阻和容量。Gould也基于卡尔曼滤波方法和线性拟合方法辨识电池模型中的容量，继而获得容量随运行循环数的衰减情况。还有将电池等效电路模型中的内阻视为低频阻抗，采用滑模控制技术进行辨识。Remmlinger介绍了一种用于混合动力车的电池内阻在线辨识方法，为了实现在线应用，改进了二阶RC模型，然后基于特殊的负载信号（发动机启动时的短暂电压及电流），采用线性最小二乘法获得电池模型的内阻值。Verbrugge认为如果对系统状态参数、测量参数和噪音的演变过程比较了解，采用卡尔曼滤波优化算法来递归辨识是最具有代表性的方法。如果缺乏对状态参数、测量参数、噪音的全面了解，采用具有时间指数遗忘因子的加权递推最小二乘法将是一个较为务实的方法。Wang发现Verbrugge采用叠加积分计算电压的电池模型递推算法在采样频率较高时变得不是很稳定。据此改进了电池模型的算法，并同样也采用指数遗忘因子的加权递推最小二乘法辨识电池参数（开路电压及内阻等）。Chiang采用线性或非线性系统控制中常用的自适应控制方法，建立了基于电池等效电路模型的参数估计框架，其中为了便于采用自适应控制技术，锂离子电池等效电路模型采用状态方程来描述，可用于在线监测电池内阻及OCV，分别用于确定SOH 和SOC。Einhorn根据ΔSOC=ΔAh/C 的关系，估计容量的大小，方法为
![](https://pic1.zhimg.com/80/v2-2d5db69b045c35e6be09bd7f8428ab40_1440w.webp)
公式中，任意两个时刻（α ，β）的SOC 由OCV 查表得到，该方法可在实际中应用，可以取若干个点，两两搭配计算出多个容量值，再取平均值或中位数。这种方法比较简单，但关键在于OCV 能否精确辨识。

#### 电池组SOH 估计
在不进行均衡的条件下，电池组的容量衰减将远大于单体的容量衰减，郑岳久等提出用两维散点图解释电池组容量衰减的机理，指出电池组的容量衰减量为剩余充电电量最小单体的容量损失与单体间负极的活性锂离子损失差异之和。为了得到电池组的容量，需要首先获得单体的容量。单体容量获取可以通过上述基于模型参数的辨识方法获得，也可以通过充电电压曲线变换方法获取。

### SOF功能状态评估
估计电池SOF 可以简单认为是在估计电池的最大可用功率。一般而言，电池的最大可用功率受到电流、电压、SOC、温度等参数的限制，还与电池的老化程度、故障状态等有关。常用的SOF 估计方法可以分为基于电池MAP图的方法和基于电池模型的动态方法两大类。

#### **基于MAP图算法**
基于电池测试（通常为HPPC测试）数据和最大、最小电压限制，可以获得在不同SOC 下的最大充放电功率。在不同温度、不同衰减程度下进行电池测试，可以建立最大充放电功率与温度、SOC、SOH 的关系，得到最大充放电功率MAP图。基于MAP图，实车BMS可以通过插值得到电池的最大充放电功率，实现SOF 估计。

Do等分别研究了不同SOC、温度、累计放电容量下的最大充放电功率，并建立了最大充放电功率的函数解析式，实现了对SOF 的预测。基于MAP图的估计方法简单直接，但需要存储多维MAP图，并且只考虑了静态特性，而对动态工况下的充放电功率估计有一定的局限性。

#### **基于电池模型的动态算法**

根据电池模型，综合考虑电池的电流、电压、SOC、功率等限制，可以得到最大充放电电流，从而计算得到电池的最大充放电功率。韩雪冰根据电池模型，给出不同电流输入情况下电池的端电压情况，通过迭代计算，获得电池单体在电压限制条件下所允许的最大电流Imax,voltage 和最小电流Imin,voltage，并且从电池的机理出发，考虑了电池副反应速率限制下的最大最小电流，其方法类似于求取端电压限制下的最大充放电电流。最后综合考虑上述限制，获得电池单体的最大最小电流。Sun 等分析比较了几种最大可用功率预测方法，包括HPPC法、SOC 限制法、电压限制法，以及基于动态模型的多参数估计法，并通过HPPC测试得到充放电电阻，基于Rint模型，利用端电压限制，估计电池的最大充放电功率。但这种方法估计的实际上是瞬时最大功率。并且由于Rint模型不够精确，可能过于乐观地估计了功率，还可能引起过充过放。Sun等认为若允许的SOC 变化范围很大，计算出的最大最小电流可能很大，并不合理，应与其他方法联合使用。电压限制法考虑在端电压限制下一段时间内的最大充放电功率，但仍使用了Rint模型，原理上与前述方法类似，只是算法上并没有采用迭代估计的方法，而是基于模型直接计算电流限值。基于动态模型的多参数估计方法实质上是基于Thevenin模型的电压限制法，综合SOC 与电流的限制，进而得到最大充放电电流。

以上是获得电池单体最大充放电电流的方法。实车上电池组由众多电池单体组成，由于单体之间存在不一致性，若要单独计算每个电池单体的最大可用功率，计算量太大，

韩雪冰提出了充、放电关键电池单体的概念，以减少计算量。综合考虑各种限制条件，可以得到最终的最大最小电流Imax,total和Imin,total，将Imax,total、Imin,total代入电池模型中可计算得到对应的端电压Umax,total，Umin,total，进一步可以得到最大充放电功率，即
![](https://pic1.zhimg.com/80/v2-7c402a0a4804666af577b067dbad937c_1440w.webp)

### SOE可用能量状态估计
也叫剩余能量估算。
剩余能量（RE）或能量状态（SOE）是电动汽车剩余里程估计的基础，与百分数的SOE 相比，RE 在实际的车辆续驶里程估计中的应用更为直观。在电动汽车使用过程中，电池的剩余能量（RE）是指以某一工况行驶时，从当前时刻直至电池放电截止过程中，电池累计提供的能量。RE 可以由电池端电压Ut与相应的累积放电容量Qcum组成的坐标系上的面积表示，如下图所示。
![](https://pic2.zhimg.com/80/v2-2096b08319e7ac41d641ddd140e95079_1440w.webp)
#### 电池剩余能量示意图
当前时刻t 的电池端电压为Ut(t)，放电截止时刻记为tlim，对应的端电压为电池允许的最低放电电压Ut(tlim)。当前时刻的荷电状态为SOC(t)，已累积的放电容量为Qcum(t)。放电截止时刻tlim 对应的SOC 和累积容量分别记为SOClim和Qcum(tlim)。图中，端电压变化表示为绿色曲线，曲线下围成的（绿色斜线）面积对应电池当前时刻在此种工况下的剩余能量RE(t)，其计算过程对应公式如下。
![](https://pic2.zhimg.com/80/v2-fd486f1d609caa1cdc07dc39a0715f4d_1440w.webp)
由于不同的充放电情况对应的端电压响应不同，使得电池在同一时刻t 提供的剩余能量RE(t)也不相同。此处用一组标准电流倍率下的放电情况作对照，标准情况的端电压Ut,st如图中蓝色曲线（Qcum-Ut,st）所示。由电池SOC 和标准放电容量的定义，此时放电截止位置的SOC 值SOClim,st为0，累积放电容量Qcum,st等于电池标准容量Qst。标准放电工况下对应的剩余能量REst(t)与之前的RE(t)有明显的差距。电池剩余放电能量的差异同样可以由当前的RE(t)与理论上最大的剩余放电能量（电池开路电压OCV 曲线围成的面积，图中黑色虚线所示）进行比较。

不同放电工况下电池的能量损失不同，因此只有预测某一特定功率需求下的电池电压响应过程，才能获得准确的RE预测值。由于锂离子电池的特点，其电压输出受到很多变量的影响，如当前SOC、温度、衰减程度SOH，因此在能量预测过程中除传统的SOC 估计模型外，还需要一个专门的电压预测模型。刘光明等提出一种适用于动态工况的电池剩余放电能量精确预测方法EPM（energy prediction method），如下图所示，该方法基于当前的电池状态和未来的电流输入，根据电池模型对未来放电过程的电压变化进行预测，并计算放电过程中的累积能量。预测过程中，根据当前的电压、电流测量值对模型参数进行修正，对端电压序列与RE 的预测结果进行更新。
![](https://pic3.zhimg.com/80/v2-43d719ee6ccae26fe50fe51420bc21de_1440w.webp)
电池剩余放电能量预测方法（EPM）结构

### SOP动力电池功率边界
算法的目的就是权衡多重因素的影响指导控制单元（如VCU）更合理的使用动力电池系统。对于纯电动车辆，动力电池是唯一的能量获取来源SOP策略相对简单，而对于混合动力车辆而言，一方面动力电池容量小则必然在运行中需要高倍率输出，对功率平稳输出的优化就更为重要。另一方面内燃机系统（或燃料电池系统）如何与动力电池进行功率分配才得以实现低能耗、高性能也需要通过SOP算法来优化。说个通熟易懂的比方：如果头文字D中车手们开的是电动汽车，高桥凉介抱着电脑标定的就是SOP参数。用户可以根据实际需求来选择是希望车辆性能更强劲或是电池系统寿命更长久。

SOP算法设计不仅仅取决于电芯特性本身，同时与pack系统设计技术，整车功率需求及工况特性都有着密切的关系。从算法设计上可以分别从Pack评估、Cell评估、Fault评估、实车运行标定四方面进行。

#### Pack评估

评估Pack功率边界的第一步是需要通过电芯实验、热仿真分析、数据拟合得到如下四张表。即在不同温度、SOC时刻的持续放电功率、脉冲放电功率、持续充电功率、脉冲充电功率。如脉冲功率可先通过HPPC实验获取电芯内阻特性曲线，从而计算基于电芯功率特性的脉冲边界。需要注意的是在通常情况下电芯在45℃以上的功率性能可能比常温下更加优异，因此pack功率边界还需要结合pack热管理能力和电芯寿命衰减特性对功率边界进行优化。  

得到了脉冲功率和持续功率的lookup table后，接下去要思考什么时候允许脉冲功率输出，什么时候只允许持续功率输出。如下图所示：电池系统在启动初期对VCU发送功率边界为脉冲功率，当实际运行电流超过允许的持续电流时，对超过部分进行功率积分，当累计溢出功率超过设定值后，BMS按设定速率不断降低功率边界至当前电池的持续功率，直至电池功率特性恢复后功率边界再按特定速率返回脉冲功率。  
  
由此我将功率边界问题想像为"水箱模型"。水箱下方的出水龙头表示当前实际的输出功率，水箱上方的进水龙头的流速表示电池自身的功率恢复能力。水箱中的水容量代表电池可承受的脉冲功率输出的能力（pulse power - continuous power）* t。当水箱中的水降至warning line 则需要通过降低功率边界减少出水量，当水箱水位达到reset line则可允许出水量达到脉冲值。通过这个简单的物理模型我们就可以用算法来计算实时的功率边界曲线。  

#### Cell评估

Cell评估的目的是对Pack评估的结果进行补充，防止电池组系统中的一致性差异导致个别极端的cell不满足当前状态（SOC&温度）的功率性能。一旦出现了类似情况可能导致单体过充、过放的事件。因此在pack评估的基础上同时叠加cell评估。如下图所示的表中定义了在不同电压值下电池允许的放电和充电功率。

  
#### Fault评估
由于电池组系统中可能出现除电池以外的其他故障，如绝缘故障、通信故障、热管理系统故障等。当触发该类故障是可能导致系统整体性能的下降，需要降低功率输出或者进入跛行模式。因此还需要考虑故障状态调节功率边界。  

#### 实时监测状态值
此状态量需要实车在线实时监测，但是在没有故障出现的前提下，SOP的上报时间间隔的需求并不像SOC那样短（SOC为10ms，并不是一成不变），况且SOP的计算复杂程度也要远远多过一个计算循环内的SOC计算，综上考虑，SOP的上报时间间隔会相对较长，100ms或者1s都是可以接受的。

SOP的计算模型有三部分组成，查表模型，等效电路模型以及热电耦合模型。

##### 第一部分
就是前部分概念中提到功率MAP查表模型，如下图，
![](https://pic1.zhimg.com/80/v2-ec10fc9fc9195033535e6616687b6860_1440w.webp)
查表模型会根据当前的SOC,和电芯温度，查表得到一个放电功率P(kW)，这也是接下来等效电路模型的第一个输入，可以假想成，此功率就是未来10s的运行工况。

##### 第二部分
等效电路模型同SOC估算中应用的等效电路模型为同一模型，包括所有的模型内部参数以及寿命状态。二阶RC电路模型如下图所示。
![](https://pic1.zhimg.com/80/v2-26e75fa18087e38397922df91c04638c_1440w.webp)
等效电路模型中所有的模型参数也都将以SOC-温度的二阶查表的方式实现，电路模型的意义也在于我们知道了未来工况，就可以知道未来工况的运行过程中，所有的电路响应，即电流与等效电路中每一部分的电压。而最终的端电压的计算，也将成为未来工况可否实现的判断条件。例如，如果未来10s以一个恒定功率进行仿真计算，发现端电压已经降到了实际应用中的报警截止电压，就可以此功率P值并不是一个合理的可以上报的值，接下来如何继续计算，将在后几节的管理策略中进行详述。由此也可见，等效电路的模型精度也将直接影响到SOP的计算。

##### 第三部分
模型为热电耦合模型，由热电耦合模型章节中介绍的，这个模型的主要作用在于可以通过未来工况计算电池的温升。而需要进行标定和辨识几个重要参数，也在于温度传感器的采集值与电芯实际温度的映射关系，与热管理系统介入后的散热和加热效率的标定。如何处理好这几个值，也是整个热电耦合模型的关键。

等效电路模型与热电耦合模型间交互，也在于每个离散时间段内，温升的变化，会在下一个离散时间段开始计算的影响所有的参数查表，而等效电路的参数，也将在下一个loop中影响电池的温度计算，这两个模型的数据交换，也是整个SOP计算的核心，会使最终的输出值，既满足端电压和电池温度两个限制量。

##### 难点
由MAP图可以看出来，在比较大的范围内，即SOC中高端，温度适宜这种条件下，车辆动力电池的输出功率都可以达到一个比较高的标准。而在低SOC,温度严苛条件下，功率值都会大幅度降低，而SOP的计算迭代，也都将在边界部分出现偏差，甚至可以想象，输出数据重要性与误差带来的风险也在此处陡增。优秀的SOP估算算法，必将是覆盖所有可出现的极端严苛条件，全寿命周期内精度都受到保证的。

#### 实车运行标定

上述三部分主要从电池系统的角度进行了最优功率边界的设计，但动力电池作为整车的零部件之一，局部最优的考虑或许得不到整体最优，因此实车运行标定是必不可少的环节，甚至可以说起到画龙点睛的作用。比如从电池实验数据上看很容易得出高倍率的充放电会加速电池寿命衰减，那电池的功率边界区间是否是越窄对延长电池寿命越有帮助呢？我通过下面的案例来论证一下。

此前参与某款燃料电池与锂电池混动车型的开发。电机峰值功率75kw，燃料电池最大输出功率35kw。由于燃料电池功率响应速率较迟缓，瞬间的功率需求由动力电池输出。7.4版本的软件中充电功率限制在22kw，实际跑车的现象是电池温升较快，且soc较难控制在理想工作区间（40%~55%）。进一步分析原因在于充电功率边界限制在22kw导致燃料电池的输出偏低，车辆加速时80%的功率需求加载在了动力电池上，导致运行期间动力电池吞吐量较大，且放出电量与充入电量不平衡。在7.7版本的软件中对充电功率限制标定为33kw，从而更大程度的发挥了燃料电池的输出，从运行数据上看动力电池吞吐量显著降低，充放电电量更为平衡，电池温升也得到了有效的控制。可谓放大了功率边界区间反而减少了功率负担。  

**总结：**
动力电池功率边界的设计对提升整车性能、避免动力电池触发运行故障、延长动力电池寿命等方面有着极其关键的作用。在实现SOP算法过程中需充分考虑电芯、热管理、故障处理等因素的影响，同时实车运行标定对整体系统的优化有着非凡的意义。

## 电动机
也叫做马达。能够将电能转换成机械能并做功产生动能来驱使其他装置的电气设备。
![](readme.assets/Pasted%20image%2020230730131135.png)

### 依磁场方向分类
- [轴向磁场电动机](https://zh.wikipedia.org/wiki/%E8%BD%B4%E5%90%91%E7%A3%81%E5%9C%BA%E7%94%B5%E5%8A%A8%E6%9C%BA "轴向磁场电动机")
- [径向磁场电动机](https://zh.wikipedia.org/wiki/%E5%BE%84%E5%90%91%E7%A3%81%E5%9C%BA%E7%94%B5%E5%8A%A8%E6%9C%BA "径向磁场电动机")

### 依使用电源分类
- [直流马达](https://zh.wikipedia.org/wiki/%E7%9B%B4%E6%B5%81%E9%A6%AC%E9%81%94 "直流马达")：使用永久磁铁或电磁铁、电刷、整流子等元件，电刷和整流子将外部所供应的直流电源，持续地供应给转子的线圈，并适时地改变电流的方向，使转子能依同一方向持续旋转。直流电的操作 电动机基于以下原理：当将载流导体置于磁场中时，导体会受到机械力。
- [交流马达](https://zh.wikipedia.org/wiki/%E4%BA%A4%E6%B5%81%E9%A6%AC%E9%81%94 "交流马达")：将交流电通过马达的定子线圈，设计让周围磁场在不同时间、不同的位置推动转子，使其持续运转
- [脉冲马达](https://zh.wikipedia.org/w/index.php?title=%E8%84%88%E8%A1%9D%E9%A6%AC%E9%81%94&action=edit&redlink=1 "脉冲马达（页面不存在）")：电源经过数位IC晶片处理，变成脉冲电流以控制马达，步进马达就是脉冲马达的一种。

### 依构造分类
- [同步马达](https://zh.wikipedia.org/wiki/%E5%90%8C%E6%AD%A5%E9%A6%AC%E9%81%94 "同步马达")：特点是恒速不变与不需要调速，起动转矩小，且当马达达到运转速度时，转速稳定，效率高。
- [感应马达](https://zh.wikipedia.org/wiki/%E6%84%9F%E6%87%89%E9%A6%AC%E9%81%94 "感应马达")：又名[异步马达](https://zh.wikipedia.org/wiki/%E5%BC%82%E6%AD%A5%E7%94%B5%E5%8A%A8%E6%9C%BA "异步电动机")，特点是构造简单耐用，且可使用电阻或电容调整转速与正反转，典型应用是[风扇](https://zh.wikipedia.org/wiki/%E9%A2%A8%E6%89%87 "风扇")、[压缩机](https://zh.wikipedia.org/wiki/%E5%A3%93%E7%B8%AE%E6%A9%9F "压缩机")、[冷气机](https://zh.wikipedia.org/wiki/%E5%86%B7%E6%B0%A3%E6%A9%9F "冷气机")。
- [可逆马达](https://zh.wikipedia.org/w/index.php?title=%E5%8F%AF%E9%80%86%E9%A6%AC%E9%81%94&action=edit&redlink=1 "可逆马达（页面不存在）")：基本上与感应马达构造与特性相同，特点马达尾部内藏简易的刹车机构（摩擦刹车），其目的为了借由加入摩擦负载，以达到瞬间可逆的特性，并可减少感应马达因作用力产生的过转量。
- [步进马达](https://zh.wikipedia.org/wiki/%E6%AD%A5%E9%80%B2%E9%A6%AC%E9%81%94 "步进马达")：特点是[脉冲马达](https://zh.wikipedia.org/w/index.php?title=%E8%84%88%E8%A1%9D%E9%A6%AC%E9%81%94&action=edit&redlink=1 "脉冲马达（页面不存在）")的一种，以一定角度逐步转动的[马达](https://zh.wikipedia.org/wiki/%E9%A6%AC%E9%81%94 "马达")，因采用开回路（Open Loop）控制方式处理，因此不需要位置检出和速度检出的回授装置，就能达成精确的位置和速度控制，且稳定性佳。
- [伺服马达](https://zh.wikipedia.org/wiki/%E4%BC%BA%E6%9C%8D%E9%A6%AC%E9%81%94 "伺服马达")：特点是具有转速控制精确稳定、加速和减速反应快、动作迅速（快速反转、迅速加速）、小型质轻、输出功率大（即功率密度高）、效率高等特点，广泛应用于位置和速度控制上。
- [线性马达](https://zh.wikipedia.org/wiki/%E7%B7%9A%E6%80%A7%E9%A6%AC%E9%81%94 "线性马达")：具有长行程的驱动并能表现高精密定位能力。
- 其他：旋转换流机（Rotary Converter）、旋转放大机（Rotating Amplifier）等。

### 机械结构
这块不做多余描述，结构这块将在（机械设计文件夹）中重点讲解。
<img src=" https://upload.wikimedia.org/wikipedia/commons/f/f1/3phase-rmf-noadd-60f-airopt.gif"/>
电动机的种类很多，以基本结构来说，其组成主要由[定子](https://zh.wikipedia.org/wiki/%E5%AE%9A%E5%AD%90 "定子")和[转子](https://zh.wikipedia.org/wiki/%E8%BD%AC%E5%AD%90 "转子")所构成。定子在空间中静止不动，转子则可绕轴转动，由轴承支撑。定子与转子之间会有一定空气间隙（气隙），以确保转子能自由转动。机壳（场轭）需要用高导磁系数材料制成，要当作磁路用。
[直流马达](https://zh.wikipedia.org/wiki/%E7%9B%B4%E6%B5%81%E9%A6%AC%E9%81%94 "直流马达")的原理是定子不动，转子依相互作用所产生作用力的方向运动。[交流马达](https://zh.wikipedia.org/wiki/%E4%BA%A4%E6%B5%81%E9%A6%AC%E9%81%94 "交流马达")则是定子绕组线圈通上交流电，产生旋转[磁场](https://zh.wikipedia.org/wiki/%E7%A3%81%E5%A0%B4 "磁场")，旋转磁场吸引转子一起作旋转运动。

### 电磁原理
马达的旋转原理的依据为[佛来明右手定则](https://zh.wikipedia.org/wiki/%E4%BD%9B%E4%BE%86%E6%98%8E%E5%8F%B3%E6%89%8B%E5%AE%9A%E5%89%87 "佛来明右手定则")或是[右手开掌定则](https://zh.wikipedia.org/wiki/%E5%8F%B3%E6%89%8B%E9%96%8B%E6%8E%8C%E5%AE%9A%E5%89%87 "右手开掌定则")，当一导线置放于磁场内，若导线通上电流，则导线会切割[磁场线](https://zh.wikipedia.org/wiki/%E7%A3%81%E5%A0%B4%E7%B7%9A "磁场线")使导线产生移动。[电流](https://zh.wikipedia.org/wiki/%E9%9B%BB%E6%B5%81 "电流")进入[线圈](https://zh.wikipedia.org/wiki/%E7%B7%9A%E5%9C%88 "线圈")产生[磁场](https://zh.wikipedia.org/wiki/%E7%A3%81%E5%A0%B4 "磁场")，利用[电流的磁效应](https://zh.wikipedia.org/wiki/%E9%9B%BB%E6%B5%81%E7%9A%84%E7%A3%81%E6%95%88%E6%87%89 "电流的磁效应")，使[电磁铁](https://zh.wikipedia.org/wiki/%E9%9B%BB%E7%A3%81%E9%90%B5 "电磁铁")在固定的磁铁内连续转动的装置，可以将电能转换成动能。与[永久磁铁](https://zh.wikipedia.org/wiki/%E6%B0%B8%E4%B9%85%E7%A3%81%E9%90%B5 "永久磁铁")或由另一组线圈所产生的[磁场](https://zh.wikipedia.org/wiki/%E7%A3%81%E5%A0%B4 "磁场")互相作用产生动力。

#### 换向器原理
有刷电机：定子是永磁体，转子绕组的电流变换。
无刷电机：转子是永磁体，定子通过编码器/控制器控制磁极方向。

###### 有刷电机
有刷电机是大家最早接触的一类电机，中学时物理课堂上介绍电动机也是以它为模型来展示的。有刷电机的主要结构就是定子+转子+电刷，通过旋转磁场获得转动力矩，从而输出动能。电刷与换向器不断接触摩擦，在转动中起到导电和换相作用。
<img src="https://pic2.zhimg.com/v2-72929b987a72f85afb176f281df99591_b.webp"/>
有刷电机采用机械换向，磁极不动，线圈旋转。电机工作时，线圈和换向器旋转，磁钢和碳刷不转，线圈电流方向的交替变化是随电机转动的换相器和电刷来完成的。
在有刷电机中，这个过程是将各组线圈的两个电源输入端，依次排成一个环，相互之间用绝缘材料分隔，组成一个象圆柱体的东西，与电机轴连成一体，电源通过两个碳元素做成的小柱子（碳刷），在弹簧压力的作用下，从两个特定的固定位置，压在上面线圈电源输入环状圆柱上的两点，给一组线圈通电。
随着电机转动，不同时刻给不同线圈或同一个线圈的不同的两极通电，使得线圈产生磁场的N-S极与最靠近的永磁铁定子的N-S极有一个适合的角度差，磁场异性相吸、同性相斥，产生力量，推动电机转动。碳电极在线圈接线头上滑动，象刷子在物体表面刷，因此叫碳“刷”。
相互滑动，会摩擦碳刷，造成损耗，需要定期更换碳刷；碳刷与线圈接线头之间通断交替，会发生电火花，产生电磁破，干扰电子设备。

##### 无刷电机
无刷电机中，换相的工作交由控制器中的控制电路（一般为霍尔传感器+控制器，更先进的技术是磁编码器）来完成。
<img src="https://pic1.zhimg.com/v2-bc0091ec15f7bd19094e890bf3e90418_b.webp"/>
无刷电机采取电子换向，线圈不动，磁极旋转。无刷电机，是使用一套电子设备，通过霍尔元件，感知永磁体磁极的位置，根据这种感知，使用电子线路，适时切换线圈中电流的方向，保证产生正确方向的磁力，来驱动电机。消除了有刷电机的缺点。
这些电路，就是电机控制器。无刷电机的控制器，还可以实现一些有刷电机不能实现的功能，比如调整电源切换角，制动电机，使电机反转，锁住电机，利用刹车信号，停止给电机供电。现在电瓶车的电子报警锁，就充分利用了这些功能。
无刷直流电机由电动机主体和驱动器组成，是一种典型的机电一体化产品。由于无刷直流电动机是以自控式运行的，所以不会象变频调速下重载启动的同步电机那样在转子上另加启动绕组，也不会在负载突变时产生振荡和失步。

##### 调速方式的区别
实际上两种电机的控制都是调压，只是由于无刷直流采用了电子换向，所以要有数字控制才可以实现了，而有刷直流是通过碳刷换向的，利用可控硅等传统模拟电路都可以控制，比较简单。  
1、有刷马达调速过程是调整马达供电电源电压的高低。调整后的电压电流通过整流子及电刷地转换，改变电极产生的磁场强弱，达到改变转速的目的。这一过程被称之为变压调速。
2、无刷马达调速过程是马达的供电电源的电压不变，改变电调的控制信号，通过微处理器再改变大功率MOS管的开关速率，来实现转速的改变。这一过程被称之为变频调速。

##### 性能的差异
TI的一个介绍视频关于有刷电机与无刷电机的对比，如下图所示，很完整。
![](https://pic4.zhimg.com/80/v2-6f98ed032a061982e17d7262a9ad50a7_1440w.webp)
**1、有刷电机结构简单、开发久技术成熟**
早在十九纪诞生电机的时候，产生的实用性电机就是无刷形式，即交流鼠笼式异步电动机，这种电动机在交流电产生以后得到了广泛的应用。但是，异步电动机有许多无法克服的缺陷，以致电机技术发展缓慢。尤其是直流无刷电机一直无法投入商业运营，伴随着电子技术的日新月异，直至近几年才慢慢投入商业运营，就其实质来说依然属于交流电机范畴。

无刷电机诞生不久，人们就发明了直流有刷电机。由于直流有刷电机机构简单，生产加工容易，维修方便，容易控制；直流电机还具有响应快速、较大的起动转矩、从零转速至额定转速具备可提供额定转矩的性能，所以一经问世就得到了广泛应用。

**2、直流有刷电机响应速度快，起动扭矩大**
直流有刷电机起动响应速度快，起动扭矩大，变速平稳，速度从零到最大几乎感觉不到振动，起动时可带动更大的负荷。无刷电机起动电阻大（感抗），所以功率因素小，起动扭矩相对较小，起动时有嗡嗡声，并伴随着强烈震动，起动时带动负荷较小。

**3、直流有刷电机运行平稳，起、制动效果好**
有刷电机是通过调压调速，所以起动和制动平稳，恒速运行时也平稳。无刷电机通常是数字变频控制，先将交流变成直流，直流再变成交流，通过频率变化控制转速，所以无刷电机在起动和制动时运行不平稳，振动大，只有在速度恒定时才会平稳。

**4、直流有刷电机控制精度高**
直流有刷电机通常和减速箱、译码器一起使用，使的电机的输出功率更大，控制精度更高，控制精度可以达到0.01毫米，几乎可以让运动部件停在任何想要的地方。所有精密机床都是采用直流电机控制精度。无刷电机由于在启动和制动时不平稳，所以运动部件每次都会停到不同的位置上，必须通过定位销或限位器才可以停在想要的位置上。

**5、直流有刷电机使用成本低，维修方便**
由于直流有刷电机结构简单，生产成本低，生产厂家多，技术比较成熟，所以应用也比较广泛，比如工厂、加工机床、精密仪器等，如果电机故障，只需更换碳刷即可，每个碳刷只需要几元，非常便宜。无刷电机技术不成熟，价格较高，应用范围有限，主要应在恒速设备上，比如变频空调、冰箱等，无刷电机损坏只能更换。

**6、无电刷、低干扰** 　
无刷电机去除了电刷，最直接的变化就是没有了有刷电机运转时产生的电火花，这样就极大减少了电火花对遥控无线电设备的干扰。 　

**7、噪音低，运转顺畅**
无刷电机没有了电刷，运转时摩擦力大大减小，运行顺畅，噪音会低许多，这个优点对于模型运行稳定性是一个巨大的支持。

**8、寿命长，低维护成本**
少了电刷，无刷电机的磨损主要是在轴承上了，从机械角度看，无刷电机几乎是一种免维护的电动机了，必要的时候，只需做一些除尘维护即可。